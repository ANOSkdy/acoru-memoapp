# システムデザイン仕様書

## 0. 目的・成功条件

### 目的
- “自由度が高いが複雑になりやすい”メモツールを、**日常メモに最適化**して再設計する
- **書く・探す・整理する**が迷いなく完結するUI/機能にする

### 成功条件（MVP）
- 10秒以内に「新規メモ作成 → タイトル入力 → 保存」できる
- グローバル検索で、タイトル/本文から即座に見つかる
- メモが増えても「最近・お気に入り・タグ・フォルダ」で破綻しない
- ゴミ箱/復元・最低限の履歴（リビジョン）で“事故”に耐える

---

## 1. 参照分析：Notionの構造要点（複雑さの源泉）

Notionの主要概念は、**ページがブロック（block）の積み重ね**であり、テキスト以外に画像・データベース等の多様なブロックを扱える点です。

### 1.1 ナビゲーション（左サイドバー中心）
- サイドバーでページ階層・お気に入り・設定・テンプレート・ゴミ箱等へアクセスできる設計。

### 1.2 コンテンツ（ブロック）
- 見出し・箇条書き・ToDo・トグル・引用・区切り・コールアウト等、基本ブロックが豊富。
- 「なんでもブロックで表現できる」自由度が、UI/実装/学習コストを押し上げる要因。

### 1.3 データベースとビュー
- データベースを複数のビュー（テーブル/リスト/ボード/カレンダー/タイムライン/ギャラリー等）で切り替えられる。
- プロパティ（タグ、日付、式、リレーション等）による拡張が強力だが設計が重い。

### 1.4 共有・権限
- Shareメニューと権限レベルでアクセス制御ができる（コラボ前提）。

### 1.5 コメント・メンション・リマインド・通知
- コメントやメンション、リマインダー、通知/Inbox機能で共同作業を支える。

### 1.6 検索
- サイドバーのSearchやショートカットでワークスペース検索ができる。

### 1.7 復元・履歴・入出力
- ゴミ箱から復元でき、ページのVersion historyも提供されている。
- インポート/エクスポートで他ツール移行やバックアップが可能。

---

## 2. 本アプリの設計方針（Notionから“引き算”した思想）

### 2.1 コア思想
- **ページ中心**：メモ＝ページ。まず書けることを最優先
- **ブロックは最小集合**：日常メモに必要なブロックだけ
- **データベース機能はMVPでは入れない**：代わりに「タグ」「簡易ToDo」「固定リンク（ピン）」で運用
- **個人利用ファースト**：共有・コメント・通知は後回し

### 2.2 非目標（MVPでやらない）
- 複数ビュー切替（ボード/タイムライン等）や高度なプロパティ（式/ロールアップ/リレーション）
- Inbox/通知ハブ（共同作業前提）
- 高機能なテンプレートマーケット/DBテンプレート

---

## 3. 画面/機能一覧（Notion → シンプル版への整理）

### 3.1 機能比較（“シンプル化”マップ）

| 領域 | Notionの代表要素 | 本アプリ（簡略化） | ねらい |
|---|---|---|---|
| ナビ | サイドバーに多領域（ページ階層/お気に入り/設定/ゴミ箱等） | サイドバー固定：**最近 / すべて / お気に入り / タグ / ゴミ箱 / 設定** + フォルダツリー | 迷いを減らす |
| 編集 | 多種ブロック（ToDo/Toggle/Callout等） | ブロックは**8〜10種類**に限定（下記） | 学習コスト/実装を削減 |
| DB/ビュー | DB + 複数ビュー（リスト/ボード/カレンダー等） | MVPは**DBなし**（タグ/固定/並び替えで代替） | 機能肥大の防止 |
| 共有/権限 | 共有メニューと権限レベル | MVPは**個人のみ**。V1で「リンク共有（閲覧のみ）」 | まず個人体験 |
| コメント | コメント/メンション | MVPは無し。V2でページコメントのみ | コラボは後段 |
| 検索 | ワークスペース検索 + ショートカット | **Cmd/Ctrl+K**のコマンドパレット＋全文検索 | “探す”を最短に |
| 履歴/復元 | ゴミ箱/Version history | ゴミ箱＋**軽量リビジョン（自動スナップショット）** | 事故耐性 |
| 入出力 | インポート/エクスポート | MVP：Markdownエクスポート（ページ単位） | まずバックアップ |

---

## 4. 画面一覧（MVP優先度つき）

### 4.1 MVP画面（必須）
| 画面ID | 画面名 | 主要目的 | 主な要素/アクション |
|---|---|---|---|
| S-01 | サインイン | 認証 | メール/SSO（任意）、ログイン、利用規約 |
| S-02 | ホーム（最近） | 直近の作業再開 | 最近開いたメモ、ピン、おすすめ（任意） |
| S-03 | すべてのメモ | 一覧管理 | 並び替え（更新順/作成順/タイトル）、フィルタ（タグ/フォルダ） |
| S-04 | エディタ（ページ） | 作成/編集 | タイトル、ブロック編集、左にアウトライン（任意） |
| S-05 | 検索/コマンドパレット | 探す/操作 | 入力→結果、最近、アクション（新規/移動/タグ付け） |
| S-06 | タグ管理 | 整理 | タグ一覧、色（任意）、統合/削除 |
| S-07 | お気に入り | 重要メモ | ピン固定、並び替え |
| S-08 | ゴミ箱 | 復元/削除 | 復元、完全削除、期限表示（任意） |
| S-09 | 設定 | 基本設定 | プロフィール、ショートカット表示、エクスポート |

### 4.2 将来（V1〜V2）
- 共有リンク（閲覧のみ）・共同編集（権限）
- コメント/メンション/リマインド
- インポート（Markdown/HTML/CSV等）
- 簡易“コレクション”（DBの軽量版：リストのみ）

---

## 5. 情報設計（IA）と基本UI構造

### 5.1 IA（階層）
- ユーザー
  - ワークスペース（MVPは1つで固定でも可）
    - フォルダ（任意）
      - ページ（メモ）
        - ブロック（本文構造）

### 5.2 基本レイアウト
**Desktop**
- 左：サイドバー（固定）
- 中央：一覧 or エディタ
- 右：補助（任意：ページ情報/タグ/履歴）

**Mobile**
- タブ or ドロワーで「最近/検索/一覧/設定」
- エディタは全画面（戻るで一覧）

---

## 6. 編集体験（ブロック仕様：最小集合）

Notionの“ブロック思想”は踏襲しつつ、ブロック種類を絞ります。

### 6.1 ブロック種別（MVP）
1. 段落（Text）
2. 見出し（H1/H2/H3）
3. 箇条書き（Bulleted）
4. 番号付き（Numbered）
5. ToDo（チェックボックス）
6. トグル（Toggle：折りたたみ）
7. 引用（Quote）
8. 区切り線（Divider）
9. コールアウト（Callout：アイコン＋背景）
10. 画像（Image：アップロード/ドラッグ&ドロップ）

### 6.2 編集ルール（重要）
- Enterで同種ブロック追加、Tab/Shift+Tabでインデント（リスト/ToDo）
- `/` でコマンド（ブロック変換・挿入）
- 自動保存（ローカル即時反映 + サーバ同期は遅延送信）

---

## 7. データ設計（Neon Postgres想定）

> DBは“ページ/ブロック/タグ/履歴”に限定し、DB複雑化を抑えます。

### 7.1 主要テーブル案
- `users`
- `workspaces`
- `pages`
  - `id`, `workspace_id`, `parent_page_id`（フォルダ兼用ならページツリーでも可）
  - `title`, `icon`（任意）, `cover`（任意）
  - `is_favorite`, `is_deleted`, `deleted_at`
  - `created_at`, `updated_at`
- `blocks`
  - `id`, `page_id`, `type`, `content_json`
  - `order_index`（並び順）
  - `created_at`, `updated_at`
- `tags`
  - `id`, `workspace_id`, `name`, `color`（任意）
- `page_tags`
  - `page_id`, `tag_id`
- `page_revisions`（軽量履歴）
  - `id`, `page_id`, `snapshot_json`, `created_at`, `created_by`

### 7.2 履歴（リビジョン）戦略
- MVPは“常時完全履歴”ではなく、以下の**スナップショット**で軽量化：
  - 5分ごと
  - 手動「スナップショット作成」
  - ゴミ箱投入時

---

## 8. API設計（Route handler想定・例）

### 8.1 ページ
- `GET /api/pages?scope=recent|all|favorites&tag=...&folder=...`
- `POST /api/pages`（新規）
- `GET /api/pages/:id`
- `PATCH /api/pages/:id`（タイトル/タグ/削除フラグ）
- `POST /api/pages/:id/restore`
- `DELETE /api/pages/:id`（完全削除）

### 8.2 ブロック
- `GET /api/pages/:id/blocks`
- `PUT /api/pages/:id/blocks`（ブロック配列の一括保存：差分最適化は後）
- `POST /api/pages/:id/revisions`（スナップショット）

### 8.3 検索
- `GET /api/search?q=...`（タイトル＋本文）
  - 将来的に Postgres の全文検索へ（tsvector）

---

## 9. 権限・共有モデル

### 9.1 MVP
- **個人のみ**（ワークスペース＝本人）
- URLは推測困難なIDでも、認可なし閲覧は不可

### 9.2 V1（推奨）
- リンク共有：`viewer`（閲覧のみ）

---

## 10. 検索・ショートカット設計

- `Cmd/Ctrl + K`：コマンドパレット
- `Cmd/Ctrl + P`：検索（同一でも可）
- エディタ内：`Cmd/Ctrl + F`（ページ内検索）

---

## 11. ゴミ箱・復元・エクスポート

### 11.1 ゴミ箱
- ソフトデリート（`is_deleted`, `deleted_at`）
- ゴミ箱一覧 → 復元/完全削除

### 11.2 エクスポート（MVP）
- ページ単位で Markdown 出力
- 将来：HTML/PDF/一括出力

---

## 12. デザイン仕様（提示条件に準拠）

### 12.1 カラースキーム（指定パレット）
- ベース: `#F9F9F9`
- プライマリ: `#4A90E2`
- セカンダリ: `#50E3C2`
- アクセント-1: `#FFD166`
- アクセント-2: `#F25F5C`
- アクセント-3: `#9D59EC`

#### 推奨トークン割り当て
- `bg-app`：#F9F9F9
- `bg-surface`：#FFFFFF
- `text-primary`：#1A1A1A
- `text-secondary`：#667085
- `border`：#E5E7EB
- `action-primary`：#4A90E2
- `action-danger`：#F25F5C
- `state-success`：#50E3C2
- `state-warning`：#FFD166
- `state-special`：#9D59EC

### 12.2 イラスト要素（指定）
- 人物: 頭身の低いシンプルなスタイル
- アイコン: 2px線画 + 塗りつぶし
- 装飾: ドット、波線、パターン
- シャドウ: 柔らかいドロップシャドウ

#### シャドウトークン案
- `shadow-sm`: 0 1px 3px rgba(0,0,0,0.08)
- `shadow-md`: 0 8px 24px rgba(0,0,0,0.10)

### 12.3 レイアウト（指定）
- セクション明確な区分け
- プロセスフロー: 左から右、または上から下
- データ表示: 円グラフ、棒グラフのフラットバージョン
- アニメーション: 控えめなトランジション（120–200ms）

### 12.4 コンポーネントスタイル指針
- **ボタン**：Primary=#4A90E2、角丸8px、Danger=#F25F5C（確認必須）
- **入力**：1px border(#E5E7EB)、focus=Primary
- **カード**：bg-surface + shadow-sm、余白16〜20px
- **サイドバー**：現在地をPrimary薄背景 + 左バー（2–3px）

### 12.5 空状態（Empty State）
- “人物イラスト + 1行メッセージ + Primaryボタン”を基本形
- 装飾（ドット/波線）で軽い演出、情報量は増やさない

---

## 13. 受け入れ基準（MVPリリース判定）

- 作成/編集/削除/復元/検索が、PC・モバイルで破綻しない
- 1000ページ程度で「一覧スクロール」「検索」が体感遅延しない
- 事故（誤削除/上書き）に対してゴミ箱＋スナップショットで復旧できる
- UIは指定の配色・アイコン/イラスト/影・レイアウト規約に準拠

---

## 付録A：MVPの“最小”ユーザーフロー
1. 起動 → ホーム（最近）
2. 新規メモ → エディタで入力（自動保存）
3. Cmd/Ctrl+K → 検索で再表示
4. タグ付け → 一覧を絞り込み
5. 誤削除 → ゴミ箱 → 復元
